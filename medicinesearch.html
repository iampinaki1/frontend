<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
<title>MediGuide AI - Medicine Search</title>
<style>
body {
    margin:0;
    font-family: 'Segoe UI', sans-serif;
    /* Added a background image to see the blur effect */
    background-image: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url("https://images.unsplash.com/photo-1532938911079-1b06ac7ceec7?auto=format&fit=crop&q=80&w=2832");
    background-position: center;
    background-repeat: no-repeat;
    background-size: cover;
    background-attachment: fixed; /* Keeps the background from scrolling */
}

/* --- MODIFIED NAVBAR STYLE --- */
.navbar {
    width:100%;
    /* 1. Set a semi-transparent background */
    background: rgba(255, 255, 255, 0.25);
    /* 2. Apply the backdrop filter for the blur effect */
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px); /* For Safari support */
    /* 3. Add a subtle border for a glassy edge */
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
    padding:12px 20px;
    position:fixed;
    top:0; left:0;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
    display:flex;
    justify-content:center;
    z-index: 1000; /* Ensure navbar stays on top of other content */
}

.navbar-content {
    width:100%;
    max-width:1200px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}
.navbar h2 {
    margin:0;
    color:rgb(13, 88, 42);  /* dark green */
}

/* --- NAVBAR BUTTONS STYLES (similar to 2nd example) --- */
.navbar-links a {
    margin-left: 15px;
    text-decoration: none;
    font-weight: 500;
    padding: 8px 20px;
    border-radius: 50px; /* Rounded buttons */
    transition: all 0.3s ease;
    display: inline-block;
}

.navbar-links a:hover {
    transform: scale(1.05); /* Add a subtle hover effect */
}

/* Secondary Button Style (like "Sign In") */
.navbar-links .signin-btn {
    background: transparent;
    border: 2px solid rgb(13, 88, 42);
    color: rgb(13, 88, 42);
}
.navbar-links .signin-btn:hover {
    background: rgb(13, 88, 42);
    color: white;
}

/* Primary Button Style (like "Sign Up") */
.navbar-links .signup-btn {
    background: rgb(13, 88, 42);
    border: 2px solid rgb(13, 88, 42);
    color: white;
}
.navbar-links .signup-btn:hover {
    background: rgb(9, 62, 29); /* A slightly darker green */
    border-color: rgb(9, 62, 29);
}


.wrapper {
    max-width: 800px;
    margin: 100px auto;
    padding: 20px;
}
.card {
    background: #fff;
    border-radius: 14px;
    padding: 25px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.15);
}
.card h3 {
    margin-top: 0;
    color: rgb(13, 88, 42);
}
input {
    flex:1;
    padding:12px;
    border-radius:8px;
    border:1px solid #ccc;
}
button {
    padding:12px 22px;
    border:none;
    border-radius:50px;
    background: transparent;
    border: 2px solid rgb(13, 88, 42);
    color: rgb(13, 88, 42);
    cursor:pointer;
    font-size: 1rem;
    transition: 0.3s ease;
}
button:hover {
    background: rgb(13, 88, 42);
    color:white;
    transform: scale(1.05);
}
#voiceBtn {
    padding: 12px 22px;
    font-size: 1rem;
}
.result {
    margin-top:20px;
    padding:15px;
    border-radius:8px;
    background:#e9ecef;
}
.result-item {
    margin-bottom: 8px;
}
</style>
</head>
<body>
<div class="navbar">
    <div class="navbar-content">
        <h2>WELCOME TO MediWeb</h2>
         <div class="navbar-links">
            <a href="/medicinesearch.html">üíä Medicine Search</a>
            <a href="/chatBot.html">ü§ñ AI Chatbot</a>
            <a href="/map.html">üó∫Ô∏è Nearby Pharmacies</a>
            <a href="/FAQs.html">‚ùì FAQs</a>
            <span id="navEmail" style="margin-left:15px; color:rgb(13, 88, 42); font-weight:600;"></span>
            <a id="logoutLink" href="#" style="margin-left:10px; color:rgb(13, 88, 42); display:none;">Logout</a>
        </div>
       
    </div>
</div>

<div class="wrapper">
    <div class="card">
        <h3>Search Medicine Information</h3>
        <div style="display:flex; gap:10px; margin-bottom:15px;">
            <input type="text" id="medicineInput" placeholder="Enter medicine or click the mic...">
            <button id="voiceBtn">üé§</button>
            <button id="searchBtn">Search</button>
        </div>
        <div style="display:flex; gap:10px; margin-bottom:15px;">
            <button id="goChatbotBtn">Go to Chatbot</button>
            <button id="logoutBtn">Logout</button>
        </div>
        <div id="output"></div>
    </div>
</div>

<script>
// Auth guard: redirect to login if not authenticated
(function(){
    const token = localStorage.getItem('token');
    if (!token) {
        window.location.href = '/login.html';
        return;
    }
})();
const searchBtn = document.getElementById('searchBtn');
const medicineInput = document.getElementById('medicineInput');
const outputDiv = document.getElementById('output');
const goChatbotBtn = document.getElementById('goChatbotBtn');
const logoutBtn = document.getElementById('logoutBtn');

// Navbar email display
(function(){
    const email = localStorage.getItem('email');
    const token = localStorage.getItem('token');
    const emailSpan = document.getElementById('navEmail');
    const logoutLink = document.getElementById('logoutLink');
    if (email && token) {
        if (emailSpan) emailSpan.textContent = email;
        if (logoutLink) {
            logoutLink.style.display = 'inline';
            logoutLink.addEventListener('click', function(e){
                e.preventDefault();
                localStorage.removeItem('email');
                localStorage.removeItem('token');
                window.location.href = '/index.html';
            });
        }
    }
})();

// Page buttons
goChatbotBtn.addEventListener('click', () => {
    window.location.href = '/chatBot.html';
});
logoutBtn.addEventListener('click', () => {
    localStorage.removeItem('email');
    localStorage.removeItem('token');
    window.location.href = '/index.html';
});

// --- API Call Logic ---
async function getMedicineInfo() {
    const medName = medicineInput.value.trim();
    if (!medName) {
        outputDiv.innerHTML = `<div class="result" style="color:red;">Please enter a medicine name.</div>`;
        return;
    }
    outputDiv.innerHTML = `<div class="result">‚è≥ Searching for <b>${medName}</b>...</div>`;

    try {
        const res = await fetch(`/api/medicine/${medName}`);
        const data = await res.json();

        if (!res.ok) {
            outputDiv.innerHTML = `<div class="result" style="color:red;"><b>Error:</b> ${data.msg}</div>`;
        } else {
            outputDiv.innerHTML = `
                <div class="result">
                    <div class="result-item"><strong>Brand Name:</strong> ${data.brand_name}</div>
                    <div class="result-item"><strong>Generic Name:</strong> ${data.generic_name}</div>
                    <div class="result-item"><strong>Manufacturer:</strong> ${data.manufacturer_name}</div>
                    <hr>
                    <div class="result-item"><strong>Food Interaction:</strong> ${data.food_interaction}</div>
                </div>`;
        }
    } catch (error) {
        outputDiv.innerHTML = `<div class="result" style="color:red;"><b>Error:</b> Could not connect to the server.</div>`;
        console.error("Fetch Error:", error);
    }
}

searchBtn.addEventListener('click', getMedicineInfo);
medicineInput.addEventListener('keypress', e => {
    if (e.key === 'Enter') getMedicineInfo();
});

// --- Voice Recognition Logic ---
const voiceBtn = document.getElementById("voiceBtn");
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

if (SpeechRecognition) {
    const recognition = new SpeechRecognition();
    recognition.continuous = false;
    recognition.lang = "en-US";
    recognition.interimResults = false;

    voiceBtn.addEventListener("click", () => {
        recognition.start();
        voiceBtn.textContent = "üéôÔ∏è";
    });

    recognition.onstart = () => {
        medicineInput.placeholder = "Listening...";
    };

    recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        medicineInput.value = transcript;
        getMedicineInfo();
    };

    recognition.onerror = (event) => {
        console.error("Speech recognition error:", event.error);
        alert("‚ö†Ô∏è Voice recognition failed. Please try again or type manually.");
    };

    recognition.onend = () => {
        voiceBtn.textContent = "üé§";
        medicineInput.placeholder = "Enter medicine or click the mic...";
    };
} else {
    voiceBtn.style.display = "none";
    alert("‚ö†Ô∏è Your browser does not support Speech Recognition. Please type your search. Use Chrome for best results.");
}
</script>
</body>
</html>